{
  "hash": "32675b2104c4a4ebc2b117911d666dff",
  "result": {
    "markdown": "---\ntitle: \"Data Visualization\"\nformat: html\nexecute: \n  enabled: true\n  error: true\n  freeze: auto\n---\n\n## Data Visualization with python\n\n<a href=\"https://matplotlib.org/\">Matplotlib</a> is one of the most popular and widely-used data visualization libraries for Python. Matplotlib was inspired by the plotting functionalities of MATLAB (a non-open source programming language). It provides a comprehensive set of tools for creating a variety of plot types, such as line plots, scatter plots, bar plots, histograms, heatmaps, and many more. \n\nIn this session we will generate and plot some artificial data and data contained in our pandas DataFrames using pyplot. We will go through the main matplotlib concepts and we will generate several kinds of plots to illustrate matplotlib and pyplot potential.\n\n## Preliminaries\n\nWe begin importing the pandas package in the same way we did in previous sessions:\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\n```\n:::\n\n\nThe first thing to do to start visualizing data with python is importing the module `pyplot` from the `matplotlib` library. As with many of our previous imports, we import the module under an 'alias' (alternate shorter name) for convenience. Finally, we specify the command `%matplotlib inline` so that, when plotting, Jupyter Notebook will not display the plots into new windows, but in the notebook itself.\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\nimport matplotlib.pyplot as plt\n%matplotlib inline\n```\n:::\n\n\n## Histograms\n\nIn the first example we will generate some artificial data by generating 10000 normally distributed values. In order to obtain that, we will first import the package `numpy`, a package used for scientific computing and data analysis. In particular, the sub-package `numpy.random` contains very handy tools to work with random numbers and its function `.normal()` generates normally distributed random numbers.\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\nimport numpy as np\nsample_data = np.random.normal(0, 0.1, 10000)\n```\n:::\n\n\nIn this case we are drawing 10000 points with 0 average and a standard deviation of 0.1. First we will use the ```pyplot``` function `hist()` to visualize a histogram of our data:\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\nplt.hist(sample_data)\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```\n(array([  15.,  166.,  775., 2036., 3092., 2466., 1118.,  289.,   38.,\n           5.]),\n array([-0.36288553, -0.28519033, -0.20749513, -0.12979993, -0.05210473,\n         0.02559047,  0.10328567,  0.18098087,  0.25867607,  0.33637127,\n         0.41406647]),\n <BarContainer object of 10 artists>)\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](data-science-with-pandas-4_files/figure-html/cell-5-output-2.png){width=583 height=411}\n:::\n:::\n\n\nAs we expected, the histogram is centered around 0 and we can already see the bell shape arising among the blocks. The default values of histogram bins (blocks) is 10, so in our case 10000 points are subdivided into 10 bins, but we can change that by specifying the parameter `bins`:\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\nplt.hist(sample_data, bins=30)\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```\n(array([   4.,    2.,    9.,   24.,   42.,  100.,  151.,  259.,  365.,\n         498.,  681.,  857.,  984., 1061., 1047.,  961.,  821.,  684.,\n         495.,  381.,  242.,  149.,   96.,   44.,   22.,    9.,    7.,\n           0.,    2.,    3.]),\n array([-3.62885528e-01, -3.36987129e-01, -3.11088729e-01, -2.85190329e-01,\n        -2.59291929e-01, -2.33393529e-01, -2.07495130e-01, -1.81596730e-01,\n        -1.55698330e-01, -1.29799930e-01, -1.03901530e-01, -7.80031307e-02,\n        -5.21047309e-02, -2.62063311e-02, -3.07931324e-04,  2.55904685e-02,\n         5.14888683e-02,  7.73872681e-02,  1.03285668e-01,  1.29184068e-01,\n         1.55082467e-01,  1.80980867e-01,  2.06879267e-01,  2.32777667e-01,\n         2.58676067e-01,  2.84574466e-01,  3.10472866e-01,  3.36371266e-01,\n         3.62269666e-01,  3.88168066e-01,  4.14066465e-01]),\n <BarContainer object of 30 artists>)\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](data-science-with-pandas-4_files/figure-html/cell-6-output-2.png){width=583 height=411}\n:::\n:::\n\n\nYou may have noticed that increasing the number of bins, the bell shape of the histogram is even more evident.\n\n## Customizing plots\n\nIn the previous examples we generated very simple plots to have a quick look at the data, either from an existing pandas DataFrame or working with artificial data. However, with Matplotlib you can customize many more aspects of your plot: axes, x and y ticks and labels, titles, legends, and much more.\n\nTo get full control of the plots generated with `Matplotlib.pyplot`, it is important to be aware of jargon used to describe different parts of the figures that you create. \n\n- At the higher level we have **Figures**. A Figure is simply the total white space where you will organise your plots. You may think of it as the white page were you are going to draw your plots or also as a box containing all your plots. You can both have a single plot per Figure or multiple plots sharing the same Figure\n- At a lower level we have **Axes**. Axes are contained into Figures. Axes is the name for a single plot or graphs (which may be a bit confusing since it can be mistaken for the x axis and y axis of a plot). You can have a single Axes per Figure, so one plot per Figure (see Plot1 on the left of the figure below) or multiple Axes per Figure, like in Plot2 (on the right) where the same Figure contains three plots distributed in two rows: two on top and one on the bottom\n- Finally, each Axes (aka each plot) contains two **Axis**, i.e. x and y axis.\n\nTo summarize, `matplotlib` organizes plots into Figures, Axes, and Axis. A Figure is a canvas that can contain one or more Axes. An Axes is where data is plotted and it is made of two Axis, x and y. Specifying parameters at these three different levels, you can customize your plots to the finest details.\n\n![Plot Hierarchy](images/plot_hierarchy.jpeg)\n\nCertain attributes like the Figure size and the number of plots inside the Figure belong to the Figure level. Ticks, labels, plot title, legend, etc belong to the Axes level. Data is plotted on Axes according to the specified x and y Axis. The main features of a \"typical\" plot generated with `matplotlib` are well summarized by the picture below from matplotlib documentation:\n\n<div style=\"text-align:center\">\n    <img src=\"images/anatomy.jpeg\" alt=\"Plot Main Features\" width=\"70%\" />\n</div>\n\n## Customizing titles and labels\n\nTo add labels to the axis of a plot, we first create a figure containing 1 Axes (or one plot named `ax`). Then we use `ax.set_xlabel('<label>')` and `ax.set_ylabel('<label>')` to specify the axis labels. We can add a title to the figure using `fig.suptitle('<title>')`\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\nfig, ax = plt.subplots() # prepare a matplotlib figure\nax.hist(sample_data, bins=30)\n\n# add labels\n\nax.set_ylabel('density')\nax.set_xlabel('value')\nfig.suptitle('Histogram', fontsize=15)\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```\nText(0.5, 0.98, 'Histogram')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](data-science-with-pandas-4_files/figure-html/cell-7-output-2.png){width=601 height=477}\n:::\n:::\n\n\nNote: To plot data on our Axes we used the same plotting methods used in the previous examples. We used ```hist()``` sampling the data in 30 bins, but this time we had to call the function from the Axes object, so ```ax.hist()```.\n\n## Creating subplots\n\nIf we want to create a figure that consists of multiple subplots we can use the ```plt.subplots()``` functions. The first two arguments indicate the number of vertical and horizontal plots we want to fit in our Figure. In this case, we will create two plots side to side, so our grid will have one row and two columns. As we want to be sure that there will be enough space for our two plots, we specify the size of the Figure to be 12 inches long and 6 inches high (inches is the default size unit, but you can specify different ones).\n\nIn this case our settings produced plots distributed in one row and two columns, so a total of 2 plots, therefore ```plt.subplots()``` will return 2 Axes objects in a tuple. We will store these two Axes into the variables ax1 and ax2.\n\n::: {.cell tags='[]' execution_count=7}\n``` {.python .cell-code}\n# prepare a matplotlib figure\nfig, (ax1,ax2) = plt.subplots(1,2,figsize=(12,6))\nax1.hist(sample_data, bins=30)\n# add labels\nax1.set_ylabel('density')\nax1.set_xlabel('value')\n\n# define and sample beta distribution\na = 5\nb = 10\nbeta_draws = np.random.beta(a, b, 1000)\n\n# plot beta distribution\nax2.hist(beta_draws, bins=30)\nax2.set_ylabel('density')\nax2.set_xlabel('value')\n```\n\n::: {.cell-output .cell-output-display execution_count=7}\n```\nText(0.5, 0, 'value')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](data-science-with-pandas-4_files/figure-html/cell-8-output-2.png){width=973 height=503}\n:::\n:::\n\n\nInstead of plotting side by side, it is also possible to add a plot inside (or actually overlaying another plot).\n\nIn order to do this we can initiate at a Figure and an Axes (the plot to put inside it), using ```plt.subplots()```, without specifying any argument (so without specifying the number or rows and columns), the method will return a Figure and a single Axes object. We will assign these two python objects to the variables *fig* and *ax*.\n\n::: {.cell execution_count=8}\n``` {.python .cell-code}\nfig, ax = plt.subplots()  # initiate an empty figure and axis matplotlib object\nax.hist(sample_data, bins= 30)\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```\n(array([   4.,    2.,    9.,   24.,   42.,  100.,  151.,  259.,  365.,\n         498.,  681.,  857.,  984., 1061., 1047.,  961.,  821.,  684.,\n         495.,  381.,  242.,  149.,   96.,   44.,   22.,    9.,    7.,\n           0.,    2.,    3.]),\n array([-3.62885528e-01, -3.36987129e-01, -3.11088729e-01, -2.85190329e-01,\n        -2.59291929e-01, -2.33393529e-01, -2.07495130e-01, -1.81596730e-01,\n        -1.55698330e-01, -1.29799930e-01, -1.03901530e-01, -7.80031307e-02,\n        -5.21047309e-02, -2.62063311e-02, -3.07931324e-04,  2.55904685e-02,\n         5.14888683e-02,  7.73872681e-02,  1.03285668e-01,  1.29184068e-01,\n         1.55082467e-01,  1.80980867e-01,  2.06879267e-01,  2.32777667e-01,\n         2.58676067e-01,  2.84574466e-01,  3.10472866e-01,  3.36371266e-01,\n         3.62269666e-01,  3.88168066e-01,  4.14066465e-01]),\n <BarContainer object of 30 artists>)\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](data-science-with-pandas-4_files/figure-html/cell-9-output-2.png){width=583 height=411}\n:::\n:::\n\n\nOnce we defined a Figure and an Axes, we can add other Axes to our Figure using ```fig.add_axes([left,bottom,length,height])``` where the argument is a list containing the coordinates of our new Axes in the following format: [left edge, bottom edge, length, and height]. The left edge and bottom edgeare scaled from 0 to 1, so that 0.5 corresponds to the center of the Figure. For example, the list of coordinates [0.5,0.5,0.33,0.33] will locate the bottom-left corner of our additional Axis at the very center of the Figure. The new plot will be as wide as ~1/3 of the length of the Figure and as high as ~1/3 of the height of the Figure.\n\n::: {.cell tags='[]' execution_count=9}\n``` {.python .cell-code}\n# prepare a matplotlib figure\nfig, ax1 = plt.subplots()\nax1.hist(sample_data, 30)\n# add labels\nax1.set_ylabel('density')\nax1.set_xlabel('value')\n\n# define and sample beta distribution\na = 5\nb = 10\nbeta_draws = np.random.beta(a, b, 1000)\n\n# plot beta distribution\n# by adding additional axes to the figure\nax2 = fig.add_axes([0.65, 0.65, 0.2, 0.2])\n#ax2 = fig.add_axes([left, bottom, right, top])\nax2.hist(beta_draws, bins=30)\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```\n(array([ 1.,  2., 10.,  9., 22., 30., 39., 59., 61., 67., 70., 66., 77.,\n        81., 73., 68., 64., 45., 35., 32., 21., 21., 16., 10.,  7.,  6.,\n         4.,  1.,  1.,  2.]),\n array([0.0387968 , 0.06179044, 0.08478408, 0.10777772, 0.13077136,\n        0.153765  , 0.17675864, 0.19975228, 0.22274592, 0.24573956,\n        0.2687332 , 0.29172684, 0.31472048, 0.33771412, 0.36070776,\n        0.3837014 , 0.40669504, 0.42968868, 0.45268232, 0.47567597,\n        0.49866961, 0.52166325, 0.54465689, 0.56765053, 0.59064417,\n        0.61363781, 0.63663145, 0.65962509, 0.68261873, 0.70561237,\n        0.72860601]),\n <BarContainer object of 30 artists>)\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](data-science-with-pandas-4_files/figure-html/cell-10-output-2.png){width=601 height=429}\n:::\n:::\n\n\n ```plt.subplots()``` parameters allow you to specify all sort of plot features: the size of the Figure in inches or cm, the number of plots to display in the Figure arranged in rows and columns, whether the subplots need to share the same axis, etc. The [Matplotlib documentation](https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.subplots.html) provides all the information and examples.\n\n## Plotting grouped data\n\nNow we will go back to the surveys dataset from the previous chapters:\n\n::: {.cell execution_count=10}\n``` {.python .cell-code}\nsurveys = pd.read_csv(('../course_materials/data/surveys.csv'))\n```\n:::\n\n\n::: {.cell execution_count=11}\n``` {.python .cell-code}\nsurveys\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>record_id</th>\n      <th>month</th>\n      <th>day</th>\n      <th>year</th>\n      <th>plot_id</th>\n      <th>species_id</th>\n      <th>sex</th>\n      <th>hindfoot_length</th>\n      <th>weight</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>7</td>\n      <td>16</td>\n      <td>1977</td>\n      <td>2</td>\n      <td>NL</td>\n      <td>M</td>\n      <td>32.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>7</td>\n      <td>16</td>\n      <td>1977</td>\n      <td>3</td>\n      <td>NL</td>\n      <td>M</td>\n      <td>33.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>3</td>\n      <td>7</td>\n      <td>16</td>\n      <td>1977</td>\n      <td>2</td>\n      <td>DM</td>\n      <td>F</td>\n      <td>37.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>4</td>\n      <td>7</td>\n      <td>16</td>\n      <td>1977</td>\n      <td>7</td>\n      <td>DM</td>\n      <td>M</td>\n      <td>36.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>5</td>\n      <td>7</td>\n      <td>16</td>\n      <td>1977</td>\n      <td>3</td>\n      <td>DM</td>\n      <td>M</td>\n      <td>35.0</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>35544</th>\n      <td>35545</td>\n      <td>12</td>\n      <td>31</td>\n      <td>2002</td>\n      <td>15</td>\n      <td>AH</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>35545</th>\n      <td>35546</td>\n      <td>12</td>\n      <td>31</td>\n      <td>2002</td>\n      <td>15</td>\n      <td>AH</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>35546</th>\n      <td>35547</td>\n      <td>12</td>\n      <td>31</td>\n      <td>2002</td>\n      <td>10</td>\n      <td>RM</td>\n      <td>F</td>\n      <td>15.0</td>\n      <td>14.0</td>\n    </tr>\n    <tr>\n      <th>35547</th>\n      <td>35548</td>\n      <td>12</td>\n      <td>31</td>\n      <td>2002</td>\n      <td>7</td>\n      <td>DO</td>\n      <td>M</td>\n      <td>36.0</td>\n      <td>51.0</td>\n    </tr>\n    <tr>\n      <th>35548</th>\n      <td>35549</td>\n      <td>12</td>\n      <td>31</td>\n      <td>2002</td>\n      <td>5</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n  </tbody>\n</table>\n<p>35549 rows × 9 columns</p>\n</div>\n```\n:::\n:::\n\n\nNow first, let's create a scatterplot where we plot the `weight` as a function of `hindfoot_length`:\n\n::: {.cell tags='[]' execution_count=12}\n``` {.python .cell-code}\nfig, ax1 = plt.subplots() # prepare a matplotlib figure\n\nsurveys.plot(\"hindfoot_length\", \"weight\", kind=\"scatter\", ax=ax1)\n\n# Provide further adaptations with matplotlib:\nax1.set_xlabel(\"Hindfoot length\")\nax1.tick_params(labelsize=16, pad=8)\nfig.suptitle('Scatter plot of weight versus hindfoot length', fontsize=15)\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n```\nText(0.5, 0.98, 'Scatter plot of weight versus hindfoot length')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](data-science-with-pandas-4_files/figure-html/cell-13-output-2.png){width=614 height=491}\n:::\n:::\n\n\n<div class=\"alert alert-block alert-success\">\n<b>Exercise 13</b>\n    \nNow go to the Jupyter Dashboard in your internet browser and continue with exercise 13.\n</div>\n\nIf we want to see if this distribution is different between males and females we can use a for loop and the groupby method to overlay two plots on top of each other in the same Axes object.\n\n::: {.cell execution_count=13}\n``` {.python .cell-code}\nfig, ax = plt.subplots()\nlabels = []\n\nfor i, group in list(surveys.groupby('sex')):\n    ax.scatter(group['hindfoot_length'], group['weight'], alpha=0.5)\n    labels.append(group['sex'].iloc[0])\n    \nax.legend(labels)\nax.set_xlabel(\"Hindfoot length\")\nax.set_ylabel(\"Weight\")\n\n```\n\n::: {.cell-output .cell-output-display execution_count=13}\n```\nText(0, 0.5, 'Weight')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](data-science-with-pandas-4_files/figure-html/cell-14-output-2.png){width=593 height=429}\n:::\n:::\n\n\nBy using `ax.scatter` 2 times inside the for loop, the two sets of points end up in the same **Axes**. Automatically the groups get different colors. With `alpha=0.5` we can make the dots semi transparent so we can see them a bit better (however due to the large number of dots many blue dots are probably still hidden). We need to add the legend afterwards (after the for loop), but we do need the provide the labels in a list. We generated the list of labels in the for loop to make sure we don't mix them up by accident.\n\nPerhaps we get a better view if we plot them in separate subplots, which is the next exercise:\n\n<div class=\"alert alert-block alert-success\">\n<b>Exercise 14</b>\n    \nNow go to the Jupyter Dashboard in your internet browser and continue with exercise 14.\n</div>\n\n### Saving your plot\n\nOnce you produced your plot you will probably need to share it in different media (website, papers, slide show, etc). To do that, we need to save our plot in a specific format. Once you have defined a Figure, you can do that with a single line of code:\n\n::: {.cell execution_count=14}\n``` {.python .cell-code}\nfig.savefig('MyFigure.png', dpi=200)\n```\n:::\n\n\nThe Figure method ```savefig()``` will save your figure into a file. The first argument of the function is the name of the output file. Matplotlib will automatically recognize the format of the output file from its name. If you will specify only a name without extention, you can indicate the format explicitly with the parameter *format*. We also need to specify the dpi (dots per inch), i.e. the quality of the picture. The quality of the picture depends on the media we want to use. 200 dpi is good enough for visualization on a screen.\n\n### What's next?\n\nAs we mentioned in the introduction, matplotlib library is huge and you can customize every single little feature of your plot. With matplotlib you can also create animations and 3D plots. Now that you know the basics of plotting data, have a look at the <a href=\"https://matplotlib.org/2.0.2/gallery.html\">matplotlib gallery</a> to check the huge variety of plots you can generate with matplotlib.\n\nThis was the last chapter of this course!\nGo to [What is next after this course](what-next.qmd), for tips on how to get started with Python in your own project!\n\n",
    "supporting": [
      "data-science-with-pandas-4_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}